<!DOCTYPE html>
<html>
<head>
<title>Event Report Generator</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
  :root {
    --color-primary: #2D0C31;
    --color-secondary: #004D4D;
    --color-accent: #00B894;
    --color-light: #B8B5FF;
    --color-lighter: #B8FFB5;
    --color-dark: #333;
    --color-gray: #6c757d;
    --color-light-gray: #e9ecef;
    --color-white: #fff;
    --color-danger: #dc3545;
    --color-success: #28a745;
    --color-warning: #ffc107;
    --color-info: #17a2b8;
    --border-radius: 8px;
    --box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
    
    /* Compact mode variables */
    --padding-section: 20px;
    --padding-card: 16px;
    --margin-bottom: 20px;
    --font-size-title: 1.5rem;
    --font-size-value: 1.8rem;
    --icon-size: 1.2rem;
    --grid-min-width: 220px;
  }

  body.compact-mode {
    --padding-section: 16px;
    --padding-card: 12px;
    --margin-bottom: 16px;
    --font-size-title: 1.3rem;
    --font-size-value: 1.5rem;
    --icon-size: 1rem;
    --grid-min-width: 180px;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, var(--color-light) 0%, var(--color-lighter) 100%);
    color: var(--color-dark);
    line-height: 1.5;
    min-height: 100vh;
    font-size: 14px;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 16px;
  }

  .header {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: var(--color-white);
    padding: var(--padding-section);
    border-radius: var(--border-radius);
    margin-bottom: var(--margin-bottom);
    text-align: center;
    box-shadow: var(--box-shadow);
    position: relative;
  }

  .compact-toggle {
    position: absolute;
    top: 16px;
    right: 16px;
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 12px;
    transition: var(--transition);
  }

  .compact-toggle:hover {
    background: rgba(255,255,255,0.3);
  }

  .header h1 {
    font-size: 2rem;
    margin-bottom: 8px;
    font-weight: 300;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }

  .header .event-id {
    font-size: 1rem;
    opacity: 0.9;
    background: rgba(255,255,255,0.2);
    padding: 6px 12px;
    border-radius: 16px;
    display: inline-block;
  }

  /* Section styles */
  .section {
    background: var(--color-white);
    border-radius: var(--border-radius);
    padding: var(--padding-section);
    margin-bottom: var(--margin-bottom);
    box-shadow: var(--box-shadow);
    border: 1px solid var(--color-light-gray);
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease forwards;
  }

  .section:nth-child(3) { animation-delay: 0.1s; }
  .section:nth-child(4) { animation-delay: 0.2s; }
  .section:nth-child(5) { animation-delay: 0.3s; }
  .section:nth-child(6) { animation-delay: 0.4s; }
  .section:nth-child(7) { animation-delay: 0.5s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .section-title {
    font-size: var(--font-size-title);
    color: var(--color-primary);
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--color-accent);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  /* Summary section - always visible */
  .summary-section {
    background: linear-gradient(135deg, var(--color-white) 0%, #f8f9fa 100%);
    border-radius: var(--border-radius);
    padding: var(--padding-section);
    margin-bottom: var(--margin-bottom);
    box-shadow: var(--box-shadow);
    border: 1px solid var(--color-light-gray);
    position: relative;
    overflow: hidden;
  }

  .summary-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--color-accent), var(--color-secondary), var(--color-primary));
  }

  .summary-section h2 {
    font-size: var(--font-size-title);
    color: var(--color-primary);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--grid-min-width), 1fr));
    gap: 16px;
  }

  .summary-card {
    background: var(--color-white);
    border-radius: var(--border-radius);
    padding: var(--padding-card);
    text-align: center;
    box-shadow: var(--box-shadow);
    border: 1px solid var(--color-light-gray);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .summary-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--card-color, var(--color-accent));
    transition: var(--transition);
  }

  .summary-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .summary-card.colleagues { --card-color: var(--color-info); }
  .summary-card.financial { --card-color: var(--color-success); }
  .summary-card.purchases { --card-color: var(--color-warning); }
  .summary-card.claims { --card-color: var(--color-primary); }

  .summary-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    font-size: var(--icon-size);
    color: var(--color-white);
    background: var(--card-color, var(--color-accent));
    box-shadow: var(--box-shadow);
  }

  .summary-value {
    font-size: var(--font-size-value);
    font-weight: bold;
    color: var(--color-dark);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }

  .summary-label {
    font-size: 0.85rem;
    color: var(--color-gray);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .summary-subtitle {
    font-size: 0.75rem;
    color: var(--color-gray);
    margin-top: 4px;
    font-style: italic;
  }

  /* Detail grid - more compact */
  .detail-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(var(--grid-min-width), 1fr));
    gap: 16px;
  }

  .detail-item {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    padding: var(--padding-card);
    border-radius: var(--border-radius);
    border-left: 3px solid var(--color-accent);
    transition: var(--transition);
    position: relative;
  }

  .detail-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .detail-label {
    font-weight: 600;
    color: var(--color-primary);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .detail-value {
    font-size: 0.95rem;
    color: var(--color-dark);
    word-wrap: break-word;
  }

  /* Grouped data items */
  .grouped-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f0f0f0;
  }

  .grouped-item:last-child {
    border-bottom: none;
  }

  .grouped-label {
    font-size: 0.8rem;
    color: var(--color-gray);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .grouped-value {
    font-weight: 500;
    font-size: 0.85rem;
  }

  /* Tooltips */
  .tooltip {
    position: relative;
    cursor: help;
  }

  .tooltip::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color-dark);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    z-index: 1000;
  }

  .tooltip:hover::after {
    opacity: 1;
  }

  .chip-container {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 4px;
  }

  .chip {
    background: linear-gradient(135deg, var(--color-accent), var(--color-secondary));
    color: var(--color-white);
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
    display: inline-block;
    box-shadow: var(--box-shadow);
    transition: var(--transition);
  }

  .chip:hover {
    transform: scale(1.05);
  }

  .document-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, var(--color-success), var(--color-accent));
    color: var(--color-white);
    padding: 6px 12px;
    text-decoration: none;
    border-radius: 16px;
    font-weight: 500;
    font-size: 0.8rem;
    transition: var(--transition);
    box-shadow: var(--box-shadow);
    margin: 4px 4px 4px 0;
  }

  .document-link:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 184, 148, 0.4);
    text-decoration: none;
    color: var(--color-white);
  }

  .date-range {
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: var(--color-white);
    padding: 8px 16px;
    border-radius: 16px;
    font-weight: 500;
    font-size: 0.85rem;
    text-align: center;
    box-shadow: var(--box-shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .company-badge {
    background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
    color: var(--color-white);
    padding: 8px 16px;
    border-radius: 16px;
    font-weight: 600;
    text-align: center;
    font-size: 0.9rem;
    box-shadow: var(--box-shadow);
  }

  .empty-state {
    text-align: center;
    color: var(--color-gray);
    font-style: italic;
    padding: 16px;
    background: #f8f9fa;
    border-radius: var(--border-radius);
    border: 2px dashed var(--color-light-gray);
    font-size: 0.85rem;
  }

  /* Budget and Financial Styles - Compact */
  .budget-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 20px;
  }

  .budget-card {
    background: linear-gradient(135deg, var(--color-accent), var(--color-secondary));
    color: var(--color-white);
    padding: var(--padding-card);
    border-radius: var(--border-radius);
    text-align: center;
    box-shadow: var(--box-shadow);
    transition: var(--transition);
  }

  .budget-card.expense {
    background: linear-gradient(135deg, var(--color-primary), var(--color-danger));
  }

  .budget-amount {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .budget-label {
    font-size: 0.85rem;
    opacity: 0.9;
  }

  .breakdown-list {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-radius: var(--border-radius);
    padding: 16px;
    border: 1px solid var(--color-light-gray);
    margin-top: 16px;
  }

  .breakdown-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--color-light-gray);
    transition: var(--transition);
  }

  .breakdown-item:hover {
    background: rgba(184, 181, 255, 0.1);
    padding-left: 8px;
    border-radius: 4px;
  }

  .breakdown-item:last-child {
    border-bottom: none;
  }

  .breakdown-type {
    font-weight: 500;
    color: var(--color-primary);
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
  }

  .breakdown-amount {
    font-weight: 600;
    color: var(--color-dark);
    background: var(--color-light-gray);
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
  }

  .breakdown-section {
    margin-top: 16px;
  }

  .breakdown-title {
    font-size: 0.9rem;
    color: var(--color-primary);
    margin-bottom: 12px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .financial-summary {
    background: linear-gradient(135deg, var(--color-secondary), var(--color-accent));
    color: var(--color-white);
    padding: var(--padding-card);
    border-radius: var(--border-radius);
    text-align: center;
    margin-top: 20px;
    box-shadow: var(--box-shadow);
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 16px;
    font-weight: 600;
    font-size: 0.8rem;
    margin: 8px 0;
  }

  /* Purchase and Claim Cards - Compact */
  .purchase-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 16px;
  }

  .purchase-card, .claim-card {
    background: var(--color-white);
    border: 1px solid var(--color-light-gray);
    border-radius: var(--border-radius);
    padding: var(--padding-card);
    box-shadow: var(--box-shadow);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    margin-bottom: 16px;
  }

  .purchase-card:hover, .claim-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .purchase-header, .claim-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 12px;
    border-bottom: 2px solid #f8f9fa;
  }

  .purchase-status {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .status-pending {
    background: #fff3cd;
    color: #856404;
  }

  .status-approved {
    background: #d4edda;
    color: #155724;
  }

  .status-rejected {
    background: #f8d7da;
    color: #721c24;
  }

  .purchase-person, .claim-app-number {
    font-weight: 600;
    color: var(--color-primary);
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
  }

  .purchase-item {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--color-dark);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .purchase-price {
    font-size: 1.1rem;
    font-weight: bold;
    color: var(--color-success);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .purchase-remarks {
    color: var(--color-gray);
    font-style: italic;
    margin-bottom: 12px;
    padding: 8px;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 2px solid var(--color-accent);
    font-size: 0.85rem;
  }

  /* Claims specific styles - compact */
  .claim-basic-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-bottom: 16px;
  }

  .claim-info-item {
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    padding: 12px;
    border-radius: 6px;
    border-left: 2px solid var(--color-accent);
    transition: var(--transition);
  }

  .claim-info-item:hover {
    transform: translateX(3px);
    box-shadow: var(--box-shadow);
  }

  .claim-info-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-gray);
    text-transform: uppercase;
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .claim-info-value {
    font-size: 0.85rem;
    color: var(--color-dark);
    font-weight: 500;
  }

  .claim-subsection {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 2px solid #f8f9fa;
  }

  .claim-subsection-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--color-primary);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .subsection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 12px;
  }

  .subsection-item {
    background: var(--color-white);
    border: 1px solid var(--color-light-gray);
    border-radius: 6px;
    padding: 12px;
    transition: var(--transition);
  }

  .subsection-item:hover {
    box-shadow: var(--box-shadow);
    border-color: var(--color-accent);
  }

  .transport-type {
    font-weight: 600;
    color: var(--color-primary);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
  }

  .transport-info {
    display: grid;
    grid-template-columns: 1fr;
    gap: 6px;
  }

  .transport-info-item {
    font-size: 0.8rem;
    color: var(--color-gray);
  }

  .transport-info-value {
    font-weight: 500;
    color: var(--color-dark);
  }

  /* Loading Styles */
  .loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
    background: var(--color-white);
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin-bottom: 20px;
  }

  .spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(184, 181, 255, 0.3);
    border-top: 3px solid var(--color-accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 16px;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .loading-text {
    color: var(--color-primary);
    font-size: 0.95rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .loading-dots::after {
    content: '';
    animation: dots 1.5s infinite;
  }

  @keyframes dots {
    0%, 20% { content: ''; }
    40% { content: '.'; }
    60% { content: '..'; }
    90%, 100% { content: '...'; }
  }

  @media (max-width: 768px) {
    .container {
      padding: 12px;
    }
    
    .header h1 {
      font-size: 1.5rem;
      flex-direction: column;
      gap: 8px;
    }
    
    .detail-grid, .budget-summary, .purchase-grid, .claim-basic-info, .subsection-grid, .summary-grid {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .purchase-header, .claim-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }

    .summary-value {
      font-size: 1.4rem;
    }

    .compact-toggle {
      position: static;
      margin-bottom: 12px;
    }
  }

  .fade-in {
    animation: fadeIn 0.5s ease forwards;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <button class="compact-toggle" onclick="toggleCompactMode()">
      <i class="fas fa-compress-alt"></i> <span id="toggle-text">Compact Mode</span>
    </button>
    <h1>
      <i class="fas fa-chart-line"></i> 
      <strong style="font-weight: 700;">Event Report</strong>
    </h1>
    <div class="event-id">Event ID: <?= eventId ?></div>
  </div>

  <div id="loading" class="loading">
    <div class="spinner"></div>
    <div class="loading-text">
      <i class="fas fa-download"></i>
      <span>Loading event data<span class="loading-dots"></span></span>
    </div>
  </div>

  <div id="content" style="display: none;">
  </div>
</div>

<script>
  const eventData = JSON.parse('<?= eventData ?>');
  const eventId = '<?= eventId ?>';


  function toggleCompactMode() {
    const body = document.body;
    const toggleText = document.getElementById('toggle-text');
    const isCompact = body.classList.toggle('compact-mode');
    
    toggleText.textContent = isCompact ? 'Normal Mode' : 'Compact Mode';
    

    localStorage.setItem('compactMode', isCompact);
  }


  document.addEventListener('DOMContentLoaded', function() {
    const isCompact = localStorage.getItem('compactMode') === 'true';
    if (isCompact) {
      document.body.classList.add('compact-mode');
      document.getElementById('toggle-text').textContent = 'Normal Mode';
    }
  });

  setTimeout(() => {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('content').style.display = 'block';
    renderPage();
  }, 1500);

  function formatDate(date) {
    if (!date) return '';
    
    let dateObj;
    
    if (typeof date === 'string') {
      if (/^\d{2}\/\d{2}\/\d{4}$/.test(date)) {
        return date;
      }
      dateObj = new Date(date);
    } else if (date instanceof Date) {
      dateObj = date;
    } else {
      return date.toString();
    }
    
    if (isNaN(dateObj.getTime())) {
      return date.toString();
    }
    
    const day = String(dateObj.getDate()).padStart(2, '0');
    const month = String(dateObj.getMonth() + 1).padStart(2, '0');
    const year = dateObj.getFullYear();
    
    return `${day}/${month}/${year}`;
  }

  function getCompanyFullName(code) {
    if (code === 'QSS') return 'Quick Stop Solutions Sdn Bhd';
    if (code === 'PMS') return 'Photomedic Solutions Sdn Bhd';
    return code;
  }

  function formatCurrency(amount) {
    if (!amount || isNaN(amount)) return 'RM 0.00';
    return 'RM ' + parseFloat(amount).toFixed(2);
  }

  function getBudgetStatus(totalBudget, totalExpense) {
    const budget = parseFloat(totalBudget) || 0;
    const expense = parseFloat(totalExpense) || 0;
    const difference = budget - expense;
    
    if (difference > 0) {
      return {
        status: 'Under Budget',
        color: 'var(--color-success)',
        icon: 'fas fa-check-circle',
        difference: Math.abs(difference)
      };
    } else if (difference < 0) {
      return {
        status: 'Over Budget',
        color: 'var(--color-danger)',
        icon: 'fas fa-exclamation-triangle',
        difference: Math.abs(difference)
      };
    } else {
      return {
        status: 'Within Budget',
        color: 'var(--color-secondary)',
        icon: 'fas fa-bullseye',
        difference: 0
      };
    }
  }

  function getStatusClass(status) {
    const statusLower = status.toLowerCase();
    if (statusLower.includes('approved')) return 'status-approved';
    if (statusLower.includes('rejected')) return 'status-rejected';
    return 'status-pending';
  }

  function getStatusIcon(status) {
    const statusLower = status.toLowerCase();
    if (statusLower.includes('approved')) return 'fas fa-check-circle';
    if (statusLower.includes('rejected')) return 'fas fa-times-circle';
    return 'fas fa-clock';
  }

  function createChips(data) {
    if (!data || !data.toString().trim()) return '<div class="empty-state"><i class="fas fa-info-circle"></i> Not specified</div>';
    
    const items = data.toString().split(',');
    let chipsHtml = '<div class="chip-container">';
    
    items.forEach(item => {
      const trimmedItem = item.trim();
      if (trimmedItem) {
        chipsHtml += `<span class="chip">${trimmedItem}</span>`;
      }
    });
    
    chipsHtml += '</div>';
    return chipsHtml;
  }

  function formatMealAllowance(mealAllowance) {
    if (!mealAllowance || mealAllowance.toString().toLowerCase().includes('select meal allowance')) {
      return 'No Meal Allowance Entitled';
    }
    return mealAllowance;
  }

  function formatTimeOnDuty(timeValue) {
    if (!timeValue || timeValue.toString().trim() === '') return 'Not specified';
    
    const timeStr = timeValue.toString().trim();
    const timeNum = parseFloat(timeStr);
    
    if (isNaN(timeNum)) return timeStr;
    
    if (timeNum === Math.floor(timeNum)) {
      return timeNum === 1 ? `${timeNum} hour` : `${timeNum} hours`;
    }
    
    const hours = Math.floor(timeNum);
    const minutes = Math.round((timeNum - hours) * 60);
    
    let result = '';
    if (hours > 0) {
      result += hours === 1 ? `${hours} hour` : `${hours} hours`;
    }
    if (minutes > 0) {
      if (result) result += ' and ';
      result += minutes === 1 ? `${minutes} minute` : `${minutes} minutes`;
    }
    
    return result || '0 minutes';
  }

  function calculateSummaryStats() {
    const stats = {
      colleaguesCount: 0,
      financialStatus: 'N/A',
      purchasesCount: 0,
      purchasesTotalAmount: 0,
      claimsCount: 0,
      claimsTotalAmount: 0
    };

    if (eventData.colleagues && eventData.colleagues.toString().trim()) {
      const colleagues = eventData.colleagues.toString().split(',');
      stats.colleaguesCount = colleagues.filter(c => c.trim()).length;
    }

    if (eventData.hasBudgetData) {
      const budgetStatus = getBudgetStatus(eventData.totalBudget, eventData.totalExpense);
      stats.financialStatus = budgetStatus.status;
    }

    if (eventData.advancePurchases && eventData.advancePurchases.length > 0) {
      stats.purchasesCount = eventData.advancePurchases.length;
      stats.purchasesTotalAmount = eventData.advancePurchases
        .filter(purchase => purchase.status.toLowerCase().includes('approved'))
        .reduce((total, purchase) => total + (parseFloat(purchase.price) || 0), 0);
    }

    if (eventData.claimsAllowances && eventData.claimsAllowances.length > 0) {
      stats.claimsCount = eventData.claimsAllowances.length;
      stats.claimsTotalAmount = eventData.claimsAllowances
        .filter(claim => claim.applicationStatus.toLowerCase().includes('approved'))
        .reduce((total, claim) => total + (parseFloat(claim.totalClaim) || 0), 0);
    }

    return stats;
  }

  function renderEventSummary() {
    const stats = calculateSummaryStats();
    
    return `
      <div class="summary-section fade-in">
        <h2><i class="fas fa-chart-bar"></i>Event Summary</h2>
        <div class="summary-grid">
          <div class="summary-card colleagues">
            <div class="summary-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="summary-value">${stats.colleaguesCount}</div>
            <div class="summary-label">Colleagues</div>
          </div>
          
          <div class="summary-card financial">
            <div class="summary-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="summary-value" style="font-size: 1.2rem;">${stats.financialStatus}</div>
            <div class="summary-label">Budget Status</div>
          </div>
          
          <div class="summary-card purchases">
            <div class="summary-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="summary-value">${stats.purchasesCount}</div>
            <div class="summary-label">Purchases</div>
            <div class="summary-subtitle">${formatCurrency(stats.purchasesTotalAmount)}</div>
          </div>
          
          <div class="summary-card claims">
            <div class="summary-icon">
              <i class="fas fa-hand-holding-usd"></i>
            </div>
            <div class="summary-value">${stats.claimsCount}</div>
            <div class="summary-label">Claims</div>
            <div class="summary-subtitle">${formatCurrency(stats.claimsTotalAmount)}</div>
          </div>
        </div>
      </div>
    `;
  }

  function renderEventDetails() {
    return `
      <div class="section fade-in">
        <h2 class="section-title"><i class="fas fa-calendar-alt"></i>Event Details</h2>
        <div class="detail-grid">
          <div class="detail-item">
            <div class="detail-label tooltip" data-tooltip="Person responsible for the event">
              <i class="fas fa-user-tie"></i>Leader
            </div>
            <div class="detail-value">${eventData.eventLeader || 'Not specified'}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-tag"></i>Event</div>
            <div class="detail-value">${eventData.eventName || 'Not specified'}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-list-alt"></i>Type</div>
            <div class="detail-value">${eventData.eventType || 'Not specified'}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-map-marker-alt"></i>Location</div>
            <div class="detail-value">
            <div class="grouped-item">
              <span class="grouped-label"><i class="fas fa-map-pin"></i> Venue</span>
              <span class="grouped-value" style="margin-left: 6px;">${eventData.location || 'Not specified'}</span>
            </div>
              <div class="grouped-item">
                <span class="grouped-label"><i class="fas fa-info-circle"></i>Status</span>
                <span class="grouped-value">${eventData.locationStatus || 'Not specified'}</span>
              </div>
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-calendar-week"></i>Schedule</div>
            <div class="detail-value">
              ${eventData.startDate && eventData.endDate ? 
                `<div class="date-range"><i class="fas fa-calendar-day"></i>${formatDate(eventData.startDate)} - ${formatDate(eventData.endDate)}</div>` :
                '<div class="empty-state"><i class="fas fa-exclamation-circle"></i>Not specified</div>'
              }
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-clock"></i>Timeslots</div>
            <div class="detail-value">${createChips(eventData.timeslots)}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-file-alt"></i>Document</div>
            <div class="detail-value">
              ${eventData.supportingDocument && eventData.supportingDocument.toString().trim() ?
                `<a href="${eventData.supportingDocument}" target="_blank" class="document-link"><i class="fas fa-external-link-alt"></i>View</a>` :
                '<div class="empty-state"><i class="fas fa-file-times"></i>None</div>'
              }
            </div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-laptop"></i>Assets</div>
            <div class="detail-value">${createChips(eventData.officeAssets)}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-users"></i>Colleagues</div>
            <div class="detail-value">${createChips(eventData.colleagues)}</div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-building"></i>Company</div>
            <div class="detail-value">
              ${eventData.affiliatedCompany && eventData.affiliatedCompany.toString().trim() ?
                `<div class="company-badge">${getCompanyFullName(eventData.affiliatedCompany.toString())}</div>` :
                '<div class="empty-state"><i class="fas fa-building"></i>Not specified</div>'
              }
            </div>
          </div>
        </div>
      </div>
    `;
  }

  function renderBudgetSection() {
    if (!eventData.hasBudgetData) {
      return `
        <div class="section fade-in" style="opacity: 0.6;">
          <h2 class="section-title"><i class="fas fa-wallet"></i>Budget & Expenses</h2>
          <div class="empty-state"><i class="fas fa-exclamation-triangle"></i>No quotation document provided - Budget data not available</div>
        </div>
      `;
    }

    const budgetStatus = getBudgetStatus(eventData.totalBudget, eventData.totalExpense);
    
    let budgetBreakdownHtml = '';
    if (eventData.budgetBreakdown && eventData.budgetBreakdown.length > 0) {
      budgetBreakdownHtml = `
        <div class="breakdown-section">
          <div class="breakdown-title">
            <i class="fas fa-list"></i> Budget Breakdown
          </div>
          <div class="breakdown-list">
            ${eventData.budgetBreakdown.map(item => `
              <div class="breakdown-item">
                <span class="breakdown-type"><i class="fas fa-tag"></i>${item.budgetType}</span>
                <span class="breakdown-amount">${formatCurrency(item.budgetAmount)}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    let expenseBreakdownHtml = '';
    if (eventData.expenseBreakdown && eventData.expenseBreakdown.length > 0) {
      expenseBreakdownHtml = `
        <div class="breakdown-section">
          <div class="breakdown-title">
            <i class="fas fa-list"></i> Expense Breakdown
          </div>
          <div class="breakdown-list">
            ${eventData.expenseBreakdown.map(item => `
              <div class="breakdown-item">
                <span class="breakdown-type"><i class="fas fa-tag"></i>${item.expenseType}</span>
                <span class="breakdown-amount">${formatCurrency(item.expenseAmount)}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    return `
      <div class="section fade-in">
        <h2 class="section-title"><i class="fas fa-wallet"></i>Budget & Expenses</h2>
        <div class="budget-summary">
          <div class="budget-card">
            <div class="budget-amount"><i class="fas fa-coins"></i>${formatCurrency(eventData.totalBudget)}</div>
            <div class="budget-label">Total Budget</div>
          </div>
          <div class="budget-card expense">
            <div class="budget-amount"><i class="fas fa-credit-card"></i>${formatCurrency(eventData.totalExpense)}</div>
            <div class="budget-label">Total Expenses</div>
          </div>
          <div class="detail-item">
            <div class="detail-label"><i class="fas fa-file-invoice"></i>Quotation</div>
            <div class="detail-value">
              <a href="${eventData.quotationDocument}" target="_blank" class="document-link"><i class="fas fa-external-link-alt"></i>View</a>
            </div>
          </div>
        </div>
        
        ${budgetBreakdownHtml}
        ${expenseBreakdownHtml}
        
        <div class="financial-summary">
          <div class="status-badge" style="background-color: ${budgetStatus.color};">
            <i class="${budgetStatus.icon}"></i>
            <span>${budgetStatus.status}</span>
          </div>
          <div style="font-size: 0.9rem; margin-top: 8px;">
            <i class="fas fa-calculator"></i>
            Difference: ${formatCurrency(budgetStatus.difference)}
          </div>
        </div>
      </div>
    `;
  }

  function renderAdvancePurchases() {
    let purchasesHtml = '';
    
    if (eventData.advancePurchases && eventData.advancePurchases.length > 0) {
      purchasesHtml = `
        <div class="purchase-grid">
          ${eventData.advancePurchases.map(purchase => `
            <div class="purchase-card">
              <div class="purchase-header">
                <div class="purchase-person"><i class="fas fa-user"></i>${purchase.person}</div>
                <div class="purchase-status ${getStatusClass(purchase.status)}">
                  <i class="${getStatusIcon(purchase.status)}"></i>${purchase.status}
                </div>
              </div>
              <div class="purchase-details">
                <div class="purchase-item"><i class="fas fa-shopping-bag"></i>${purchase.item}</div>
                <div class="purchase-price"><i class="fas fa-money-bill-wave"></i>${formatCurrency(purchase.price)}</div>
                ${purchase.remarks && purchase.remarks.toString().trim() ? 
                  `<div class="purchase-remarks"><i class="fas fa-comment"></i>${purchase.remarks}</div>` : ''
                }
                ${purchase.invoiceDocument && purchase.invoiceDocument.toString().trim() ?
                  `<a href="${purchase.invoiceDocument}" target="_blank" class="document-link"><i class="fas fa-file-invoice"></i>Invoice</a>` : ''
                }
              </div>
            </div>
          `).join('')}
        </div>
      `;
    } else {
      purchasesHtml = '<div class="empty-state"><i class="fas fa-shopping-cart"></i>No advance purchases found</div>';
    }

    return `
      <div class="section fade-in">
        <h2 class="section-title"><i class="fas fa-shopping-cart"></i>Advance Purchases</h2>
        ${purchasesHtml}
      </div>
    `;
  }

  function renderClaimsAllowances() {
    let claimsHtml = '';
    
    if (eventData.claimsAllowances && eventData.claimsAllowances.length > 0) {
      claimsHtml = eventData.claimsAllowances.map(claim => `
        <div class="claim-card">
          <div class="claim-header">
            <div class="claim-app-number"><i class="fas fa-hashtag"></i>App #${claim.applicationNumber}</div>
            <div class="purchase-status ${getStatusClass(claim.applicationStatus)}">
              <i class="${getStatusIcon(claim.applicationStatus)}"></i>${claim.applicationStatus}
            </div>
          </div>
          
          <div class="claim-basic-info">
            <div class="claim-info-item">
              <div class="claim-info-label"><i class="fas fa-user"></i>Person</div>
              <div class="claim-info-value">${claim.person}</div>
            </div>
            <div class="claim-info-item">
              <div class="claim-info-label"><i class="fas fa-clock"></i>Timeslot</div>
              <div class="claim-info-value">${createChips(claim.timeslot)}</div>
            </div>
            <div class="claim-info-item">
              <div class="claim-info-label"><i class="fas fa-utensils"></i>Meal</div>
              <div class="claim-info-value">${formatMealAllowance(claim.mealAllowance)}</div>
            </div>
            <div class="claim-info-item">
              <div class="claim-info-label"><i class="fas fa-plus"></i>Other</div>
              <div class="claim-info-value">${claim.otherAllowances || 'None'}</div>
            </div>
            <div class="claim-info-item">
              <div class="claim-info-label"><i class="fas fa-money-check-alt"></i>Total</div>
              <div class="claim-info-value" style="font-weight: bold; color: var(--color-success);">${formatCurrency(claim.totalClaim)}</div>
            </div>
            <div class="claim-info-item">
              <div class="claim-info-label"><i class="fas fa-business-time"></i>Time</div>
              <div class="claim-info-value">${formatTimeOnDuty(claim.totalTimeOnDuty)}</div>
            </div>
          </div>

          ${claim.remarks && claim.remarks.toString().trim() ? `
            <div class="claim-info-item" style="margin-top: 12px;">
              <div class="claim-info-label"><i class="fas fa-sticky-note"></i>Remarks</div>
              <div class="claim-info-value">${claim.remarks}</div>
            </div>
          ` : ''}

          ${renderStayDetails(claim.stayDetails)}
          ${renderTransportationDetails(claim.transportationDetails)}
          ${renderExtraClaims(claim.extraClaims)}
        </div>
      `).join('');
    } else {
      claimsHtml = '<div class="empty-state"><i class="fas fa-hand-holding-usd"></i>No claims and allowances found</div>';
    }

    return `
      <div class="section fade-in">
        <h2 class="section-title"><i class="fas fa-hand-holding-usd"></i>Claims and Allowances</h2>
        ${claimsHtml}
      </div>
    `;
  }

  function renderStayDetails(stayDetails) {
    if (!stayDetails || stayDetails.length === 0) return '';
    
    return `
      <div class="claim-subsection">
        <div class="claim-subsection-title">
          <i class="fas fa-bed"></i>Stay Details
        </div>
        <div class="subsection-grid">
          ${stayDetails.map(stay => `
            <div class="subsection-item">
              <div class="grouped-item">
                <span class="grouped-label"><i class="fas fa-hotel"></i>Type</span>
                <span class="grouped-value">${stay.stayType}</span>
              </div>
              <div class="grouped-item">
                <span class="grouped-label"><i class="fas fa-dollar-sign"></i>Cost</span>
                <span class="grouped-value">${formatCurrency(stay.stayCost)}</span>
              </div>
              ${stay.stayReceipt && stay.stayReceipt.toString().trim() ? `
                <div style="margin-top: 8px;">
                  <a href="${stay.stayReceipt}" target="_blank" class="document-link"><i class="fas fa-receipt"></i>Receipt</a>
                </div>
              ` : ''}
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }

  function renderTransportationDetails(transportDetails) {
    if (!transportDetails || transportDetails.length === 0) return '';
    
    return `
      <div class="claim-subsection">
        <div class="claim-subsection-title">
          <i class="fas fa-car"></i>Transportation
        </div>
        <div class="subsection-grid">
          ${transportDetails.map(transport => `
            <div class="subsection-item">
              <div class="transport-type"><i class="fas fa-route"></i>${transport.transportationType}</div>
              <div class="transport-info">
                ${transport.carType ? `
                  <div class="grouped-item">
                    <span class="grouped-label"><i class="fas fa-car-side"></i>Car</span>
                    <span class="grouped-value">${transport.carType}</span>
                  </div>
                ` : ''}
                ${transport.companyCar ? `
                  <div class="grouped-item">
                    <span class="grouped-label"><i class="fas fa-building"></i>Company</span>
                    <span class="grouped-value">${transport.companyCar}</span>
                  </div>
                ` : ''}
                ${transport.distanceTravelled ? `
                  <div class="grouped-item">
                    <span class="grouped-label"><i class="fas fa-road"></i>Distance</span>
                    <span class="grouped-value">${transport.distanceTravelled}</span>
                  </div>
                ` : ''}
                ${transport.touchNGoCost && transport.touchNGoCost > 0 ? `
                  <div class="grouped-item">
                    <span class="grouped-label"><i class="fas fa-credit-card"></i>Touch N Go</span>
                    <span class="grouped-value">${formatCurrency(transport.touchNGoCost)}</span>
                  </div>
                ` : ''}
                ${transport.transportCost && transport.transportCost > 0 ? `
                  <div class="grouped-item">
                    <span class="grouped-label"><i class="fas fa-money-bill"></i>Cost</span>
                    <span class="grouped-value">${formatCurrency(transport.transportCost)}</span>
                  </div>
                ` : ''}
              </div>
              ${transport.transportReceipt && transport.transportReceipt.toString().trim() ? `
                <div style="margin-top: 8px;">
                  <a href="${transport.transportReceipt}" target="_blank" class="document-link"><i class="fas fa-receipt"></i>Receipt</a>
                </div>
              ` : ''}
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }

  function renderExtraClaims(extraClaims) {
    if (!extraClaims || extraClaims.length === 0) return '';
    
    return `
      <div class="claim-subsection">
        <div class="claim-subsection-title">
          <i class="fas fa-plus-circle"></i>Extra Claims
        </div>
        <div class="subsection-grid">
          ${extraClaims.map(extra => `
            <div class="subsection-item">
              <div class="grouped-item">
                <span class="grouped-label"><i class="fas fa-clipboard-list"></i>Description</span>
                <span class="grouped-value">${extra.claimDescription}</span>
              </div>
              <div class="grouped-item">
                <span class="grouped-label"><i class="fas fa-dollar-sign"></i>Amount</span>
                <span class="grouped-value">${formatCurrency(extra.claimAmount)}</span>
              </div>
              ${extra.claimReceipt && extra.claimReceipt.toString().trim() ? `
                <div style="margin-top: 8px;">
                  <a href="${extra.claimReceipt}" target="_blank" class="document-link"><i class="fas fa-receipt"></i>Receipt</a>
                </div>
              ` : ''}
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }

  function renderPage() {
    const content = document.getElementById('content');
    content.innerHTML = `
      ${renderEventSummary()}
      ${renderEventDetails()}
      ${renderBudgetSection()}
      ${renderAdvancePurchases()}
      ${renderClaimsAllowances()}
    `;
  }

  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelector(this.getAttribute('href')).scrollIntoView({
          behavior: 'smooth'
        });
      });
    });

    document.addEventListener('click', function(e) {
      if (e.target.closest('.purchase-card, .claim-card, .detail-item, .summary-card')) {
        const card = e.target.closest('.purchase-card, .claim-card, .detail-item, .summary-card');
        card.style.transform = 'scale(0.98)';
        setTimeout(() => {
          card.style.transform = '';
        }, 150);
      }
    });
  });
</script>
</body>
</html>
