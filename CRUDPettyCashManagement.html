<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Petty Cash Viewer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --color-primary: #2D0C31;
      --color-secondary: #004D4D;
      --color-accent: #00B894;
      --color-light: #B8B5FF;
      --color-lighter: #B8FFB5;
      --shadow-light: rgba(45, 12, 49, 0.1);
      --shadow-medium: rgba(45, 12, 49, 0.15);
      --shadow-heavy: rgba(45, 12, 49, 0.25);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, var(--color-light) 0%, var(--color-lighter) 100%);
      min-height: 100vh;
      color: var(--color-primary);
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 32px var(--shadow-light);
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .header h1 {
      color: var(--color-primary);
      font-size: 32px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header h1 i {
      color: var(--color-accent);
    }

    .header-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .balance-btn, .topup-btn {
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 16px var(--shadow-light);
    }

    .balance-btn {
      background: linear-gradient(135deg, var(--color-accent), #00a085);
    }

    .balance-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-medium);
    }

    .topup-btn {
      background: linear-gradient(135deg, var(--color-secondary), #003d3d);
    }

    .topup-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-medium);
    }

    .filters-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 8px 32px var(--shadow-light);
      margin-bottom: 25px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .search-container {
      margin-bottom: 25px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 16px 20px 16px 50px;
      border: 2px solid rgba(45, 12, 49, 0.1);
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
    }

    .search-container i {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--color-secondary);
      font-size: 18px;
    }

    .filter-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-select {
      padding: 12px 16px;
      border: 2px solid rgba(45, 12, 49, 0.1);
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      color: var(--color-primary);
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
    }

    .content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 8px 32px var(--shadow-light);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .loading {
      text-align: center;
      padding: 80px 20px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(0, 184, 148, 0.2);
      border-top: 4px solid var(--color-accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 25px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error {
      text-align: center;
      padding: 80px 20px;
      color: #e74c3c;
      font-size: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .table-container {
      overflow-x: auto;
      max-height: 70vh;
      overflow-y: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .data-table th {
      background: linear-gradient(135deg, var(--color-primary), #1a0620);
      color: white;
      padding: 16px 12px;
      text-align: left;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
      white-space: nowrap;
      border-bottom: 2px solid var(--color-accent);
    }

    .data-table td {
      padding: 16px 12px;
      border-bottom: 1px solid rgba(45, 12, 49, 0.1);
      vertical-align: top;
      word-wrap: break-word;
      max-width: 200px;
    }

    .data-table tbody tr:hover {
      background: linear-gradient(135deg, rgba(184, 181, 255, 0.1), rgba(184, 255, 181, 0.1));
    }

    .data-table tbody tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.5);
    }

    .status-submitted {
      background: linear-gradient(135deg, #fff3cd, #ffeaa7);
      color: #856404;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-approved {
      background: linear-gradient(135deg, #d4edda, var(--color-lighter));
      color: #155724;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .status-rejected {
      background: linear-gradient(135deg, #f8d7da, #ff7675);
      color: #721c24;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .amount-cell {
      text-align: right;
      font-weight: 700;
      color: var(--color-accent);
      font-size: 16px;
    }

    .timestamp-cell {
      white-space: nowrap;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: var(--color-secondary);
    }

    .doc-btn {
      background: linear-gradient(135deg, var(--color-secondary), #003d3d);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .doc-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow-medium);
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .edit-btn, .delete-btn {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .edit-btn {
      background: linear-gradient(135deg, #ffc107, #ffb300);
      color: #212529;
    }

    .edit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
    }

    .delete-btn {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }

    .delete-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(45, 12, 49, 0.8);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      margin: 3% auto;
      padding: 0;
      border-radius: 20px;
      width: 95%;
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px var(--shadow-heavy);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .modal-header {
      background: linear-gradient(135deg, var(--color-primary), #1a0620);
      color: white;
      padding: 25px 30px;
      border-radius: 20px 20px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .close {
      color: white;
      font-size: 32px;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
      transition: all 0.3s ease;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .close:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 30px;
    }

    .balance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 25px;
    }

    .balance-card {
      border: 2px solid rgba(45, 12, 49, 0.1);
      border-radius: 16px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.8);
      position: relative;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .balance-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px var(--shadow-medium);
    }

    .balance-card.sufficient {
      border-color: var(--color-accent);
      background: linear-gradient(135deg, rgba(0, 184, 148, 0.1), rgba(184, 255, 181, 0.2));
    }

    .balance-card.critical {
      border-color: #ffc107;
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 235, 59, 0.2));
    }

    .balance-card.low {
      border-color: #fd7e14;
      background: linear-gradient(135deg, rgba(253, 126, 20, 0.1), rgba(255, 152, 0, 0.2));
    }

    .balance-card.overdrawn {
      border-color: #dc3545;
      background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(244, 67, 54, 0.2));
    }

    .balance-username {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .balance-info {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .balance-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }

    .balance-label {
      font-weight: 600;
      color: var(--color-secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .balance-value {
      font-weight: 700;
      font-size: 18px;
      color: var(--color-primary);
    }

    .balance-status {
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 700;
      text-align: center;
      margin-top: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .balance-status.sufficient {
      background: linear-gradient(135deg, var(--color-accent), #00a085);
      color: white;
    }

    .balance-status.critical {
      background: linear-gradient(135deg, #ffc107, #ffb300);
      color: #212529;
    }

    .balance-status.low {
      background: linear-gradient(135deg, #fd7e14, #f57c00);
      color: white;
    }

    .balance-status.overdrawn {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }

    .edit-minimum-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: linear-gradient(135deg, var(--color-secondary), #003d3d);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .edit-minimum-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow-medium);
    }

    .form-container {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-label {
      font-weight: 600;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-input, .form-select, .form-textarea {
      padding: 14px 18px;
      border: 2px solid rgba(45, 12, 49, 0.1);
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      color: var(--color-primary);
    }

    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
    }

    .form-buttons {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .btn-primary, .btn-secondary, .btn-success, .btn-danger {
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-accent), #00a085);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--color-secondary), #003d3d);
      color: white;
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-medium);
    }

    .btn-success {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
    }

    .btn-danger {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(220, 53, 69, 0.3);
    }

    /* Custom Alert Modal */
    .alert-modal {
      display: none;
      position: fixed;
      z-index: 1100;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(45, 12, 49, 0.8);
      backdrop-filter: blur(5px);
    }

    .alert-content {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      margin: 15% auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px var(--shadow-heavy);
      border: 1px solid rgba(255, 255, 255, 0.3);
      animation: alertSlideIn 0.3s ease-out;
    }

    @keyframes alertSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .alert-header {
      padding: 25px 30px 15px;
      border-bottom: 1px solid rgba(45, 12, 49, 0.1);
    }

    .alert-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--color-primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .alert-body {
      padding: 20px 30px 30px;
    }

    .alert-message {
      font-size: 16px;
      color: var(--color-secondary);
      line-height: 1.6;
      margin-bottom: 25px;
    }

    .alert-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .alert-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .alert-btn-primary {
      background: linear-gradient(135deg, var(--color-accent), #00a085);
      color: white;
    }

    .alert-btn-secondary {
      background: linear-gradient(135deg, var(--color-secondary), #003d3d);
      color: white;
    }

    .alert-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow-medium);
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      .header {
        flex-direction: column;
        text-align: center;
        padding: 20px;
      }
      
      .header h1 {
        font-size: 28px;
      }
      
      .filter-row {
        grid-template-columns: 1fr;
      }
      
      .data-table {
        font-size: 12px;
      }
      
      .data-table th,
      .data-table td {
        padding: 12px 8px;
      }

      .balance-grid {
        grid-template-columns: 1fr;
      }

      .modal-content {
        width: 98%;
        margin: 2% auto;
      }

      .modal-body {
        padding: 20px;
      }

      .form-buttons {
        flex-direction: column;
      }

      .btn-primary, .btn-secondary, .btn-success, .btn-danger {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      .header-buttons {
        width: 100%;
        justify-content: center;
      }

      .balance-btn, .topup-btn {
        flex: 1;
        justify-content: center;
      }

      .action-buttons {
        flex-direction: column;
        gap: 6px;
      }

      .edit-btn, .delete-btn {
        width: 100%;
        justify-content: center;
      }
    }

    ::-webkit-scrollbar {
      width: 12px;
    }

    ::-webkit-scrollbar-track {
      background: var(--color-lighter);
    }

    ::-webkit-scrollbar-thumb {
      background-color: var(--color-primary);
      border-radius: 10px;
      border: 2px solid var(--color-lighter);
    }

    ::-webkit-scrollbar-thumb:hover {
      background-color: var(--color-secondary);
    }

    * {
      scrollbar-width: thin;
      scrollbar-color: var(--color-primary) var(--color-lighter);
    }

    /* Sidebar Styles */
        .sidebar {
          width: 250px;
          height: 100vh;
          position: fixed;
          left: 0;
          top: 0;
          background-color: rgba(255, 255, 255, 0.95);
          backdrop-filter: blur(10px);
          border-right: 1px solid rgba(45, 12, 49, 0.2);
          box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
          z-index: 100;
          transition: all 0.3s ease;
          overflow-y: auto;
          scrollbar-width: none; /* Firefox */
          -ms-overflow-style: none; /* Internet Explorer 10+ */
        }

        .sidebar::-webkit-scrollbar {
          width: 0;
          height: 0;
          display: none;
        }

        .sidebar.collapsed {
          width: 60px;
        }

        .sidebar-header {
          padding: 20px;
          display: flex;
          flex-direction: column;
          align-items: center;
          border-bottom: 1px solid rgba(45, 12, 49, 0.2);
        }

        .sidebar-logo {
          font-size: 36px;
          color: var(--color-primary);
          margin-bottom: 10px;
          transition: all 0.3s ease;
        }

        .sidebar-title {
          font-size: 20px;
          font-weight: 600;
          color: var(--color-secondary);
          transition: all 0.3s ease;
          white-space: nowrap;
          overflow: hidden;
          text-align: center;
        }

        .sidebar.collapsed .sidebar-logo {
          font-size: 24px;
          margin-bottom: 0;
        }

        .sidebar.collapsed .sidebar-title {
          opacity: 0;
          width: 0;
          height: 0;
          margin: 0;
        }

        .sidebar-nav {
          display: flex;
          flex-direction: column;
          padding: 15px 0;
        }

        .sidebar-item {
          display: flex;
          align-items: center;
          padding: 15px 20px;
          color: var(--color-primary);
          transition: all 0.2s ease;
          border-left: 3px solid transparent;
          white-space: nowrap;
          overflow: hidden;
          text-decoration: none;
        }

        .sidebar.collapsed .sidebar-item {
          padding: 15px;
          justify-content: center;
        }

        .sidebar-item:hover {
          background-color: rgba(45, 12, 49, 0.1);
          border-left-color: var(--color-primary);
        }

        .sidebar-item.active {
          background-color: rgba(45, 12, 49, 0.15);
          border-left-color: var(--color-primary);
          font-weight: 600;
        }

        .sidebar-item i {
          min-width: 24px;
          font-size: 20px;
          margin-right: 15px;
        }

        .sidebar-item span {
          transition: opacity 0.2s ease;
          font-size: 16px;
        }

        .sidebar.collapsed .sidebar-item span {
          opacity: 0;
          width: 0;
          margin-left: 0;
        }

        .sidebar-toggle {
          position: fixed;
          top: 10px;
          left: 260px; /* Positioned outside the sidebar */
          width: 40px;
          height: 40px;
          background-color: var(--color-primary);
          color: white;
          border: none;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
          z-index: 101;
          transition: left 0.3s ease;
        }

        .sidebar-toggle i {
          font-size: 24px;
          transition: transform 0.3s ease;
        }

        .sidebar.collapsed + .sidebar-toggle {
          left: 70px;
        }

        .sidebar.collapsed .sidebar-toggle i {
          transform: rotate(180deg);
        }

        .mobile-sidebar-toggle {
          display: none;
          position: fixed;
          top: 10px;
          left: 10px;
          width: 40px;
          height: 40px;
          background-color: var(--color-primary);
          color: white;
          border: none;
          border-radius: 50%;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
          z-index: 1000;
          font-size: 24px;
        }

        .main-content {
          margin-left: 250px;
          transition: all 0.3s ease;
          min-height: 100vh;
          width: calc(100% - 250px);
        }

        .main-content.expanded {
          margin-left: 60px;
          width: calc(100% - 60px);
        }

        /* Mobile styles */
        @media (max-width: 768px) {
          .sidebar {
            transform: translateX(-100%);
            width: 80%;
            max-width: 300px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
          }
          
          .sidebar.open {
            transform: translateX(0);
          }
          
          .sidebar.collapsed {
            transform: translateX(-100%);
            width: 80%;
          }
          
          .main-content {
            margin-left: 0;
            width: 100%;
            padding-top: 60px; /* Space for the mobile toggle button */
          }
          
          .main-content.expanded {
            margin-left: 0;
            width: 100%;
          }
          
          .sidebar-toggle {
            display: none;
          }
          
          .mobile-sidebar-toggle {
            display: flex;
          }
          
          /* Add overlay when sidebar is open on mobile */
          .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 99;
          }
          
          .sidebar-overlay.active {
            display: block;
          }
          
          /* Adjust container padding for mobile */
          .container {
            padding: 15px;
          }
        }

        /* Small mobile devices */
        @media (max-width: 480px) {
          .sidebar {
            width: 85%;
          }
          
          .sidebar-item {
            padding: 12px 15px;
          }
          
          .sidebar-logo {
            font-size: 28px;
          }
          
          .sidebar-title {
            font-size: 18px;
          }
        }
  </style>
</head>
<body>
<!-- Sidebar HTML -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <i class="fas fa-chart-bar"></i>
    </div>
    <h2 class="sidebar-title">Claim System</h2>
  </div>
  <div class="sidebar-menu">
    <a href="YOUR_DASHBOARD_DEPLOYMENT_LINK" target="_top" class="sidebar-item">
      <i class="fas fa-tachometer-alt"></i>
      <span>Dashboard</span>
    </a>
    <a href="YOUR_EVENT_PANEL_DEPLOYMENT_LINK" target="_top" class="sidebar-item">
      <i class="fas fa-calendar-alt"></i>
      <span>Event Panel</span>
    </a>
    <a href="YOUR_CLAIMS_PANEL_DEPLOYMENT_LINK" target="_top" class="sidebar-item">
      <i class="fas fa-hand-holding-usd"></i>
      <span>Claims & Allowance Panel</span>
    </a>
    <a href="YOUR_BUDGET_PANEL_DEPLOYMENT_LINK" target="_top" class="sidebar-item">
      <i class="fas fa-dollar-sign"></i>
      <span>Budget & Expenses Panel</span>
    </a>
    <a href="YOUR_ADVANCE_PURCHASE_PANEL_DEPLOYMENT_LINK" target="_top" class="sidebar-item active">
      <i class="fas fa-shopping-cart"></i>
      <span>Advance Purchases Panel</span>
    </a>
    <a href="YOUR_PETTY_CASH_PANEL_DEPLOYMENT_LINK" target="_top" class="sidebar-item">
      <i class="fas fa-wallet"></i>
      <span>Petty Cash Panel</span>
    </a>
    <a href="YOUR_SETTINGS_DEPLOYMENT_LINK" target="_top" class="sidebar-item">
      <i class="fas fa-cog"></i>
      <span>Settings</span>
    </a>
  </div>
</aside>


<!-- Sidebar toggle button -->
<button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar">
  <i class="fas fa-bars"></i>
</button>

<!-- Mobile sidebar toggle button -->
<button class="mobile-sidebar-toggle" id="mobileSidebarToggle" aria-label="Toggle mobile sidebar">
  <i class="fas fa-bars"></i>
</button>

<!-- Main content -->
<main class="main-content" id="mainContent">
  <div class="container">
    <header class="header">
      <h1><i class="fas fa-wallet"></i>Petty Cash Management</h1>
      <div class="header-buttons">
        <button class="balance-btn" onclick="openBalanceModal()">
          <i class="fas fa-chart-line"></i>View Users Balance
        </button>
        <button class="topup-btn" onclick="openTopupModal()">
          <i class="fas fa-plus-circle"></i>Top Up
        </button>
      </div>
    </header>
    
    <div class="filters-section">
      <div class="search-container">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" class="search-input" placeholder="Search across all fields..." oninput="filterData()">
      </div>
      
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label"><i class="fas fa-user-check"></i>Reviewed By</label>
          <select id="reviewerFilter" class="filter-select" onchange="filterData()">
            <option value="">All Reviewers</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label"><i class="fas fa-user"></i>Person of Submission</label>
          <select id="personFilter" class="filter-select" onchange="filterData()">
            <option value="">All Persons</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label"><i class="fas fa-exchange-alt"></i>Transaction Type</label>
          <select id="typeFilter" class="filter-select" onchange="filterData()">
            <option value="">All Types</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label class="filter-label"><i class="fas fa-flag"></i>Status</label>
          <select id="statusFilter" class="filter-select" onchange="filterData()">
            <option value="">All Statuses</option>
          </select>
        </div>
      </div>
    </div>
    
    <div class="content">
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading petty cash data...</p>
      </div>
      
      <div id="error" class="error" style="display: none;">
        <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #e74c3c;"></i>
        <p>Error loading data. Please try again.</p>
      </div>
      
      <div id="dataContainer" style="display: none;">
        <div class="table-container">
          <table id="dataTable" class="data-table">
            <thead>
              <tr>
                <th><i class="fas fa-clock"></i> Timestamp</th>
                <th><i class="fas fa-user-check"></i> Reviewed By</th>
                <th><i class="fas fa-user"></i> Person of Submission</th>
                <th><i class="fas fa-clipboard-list"></i> Purpose</th>
                <th><i class="fas fa-exchange-alt"></i> Transaction Type</th>
                <th><i class="fas fa-money-bill-wave"></i> Amount</th>
                <th><i class="fas fa-paperclip"></i> Additional Docs</th>
                <th><i class="fas fa-comment"></i> Remarks</th>
                <th><i class="fas fa-flag"></i> Status</th>
                <th><i class="fas fa-cogs"></i> Actions</th>
              </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Balance Modal -->
  <div id="balanceModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title"><i class="fas fa-chart-line"></i>Users Balance</span>
        <span class="close" onclick="closeBalanceModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div id="balanceLoading" class="loading">
          <div class="spinner"></div>
          <p>Loading balance data...</p>
        </div>
        <div id="balanceError" class="error" style="display: none;">
          <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #e74c3c;"></i>
          <p>Error loading balance data.</p>
        </div>
        <div id="balanceContent" class="balance-grid" style="display: none;">
        </div>
      </div>
    </div>
  </div>

  <!-- Top Up Modal -->
  <div id="topupModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title"><i class="fas fa-plus-circle"></i>Top Up for a User</span>
        <span class="close" onclick="closeTopupModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form class="form-container" onsubmit="submitTopup(event)">
          <div class="form-group">
            <label class="form-label"><i class="fas fa-user"></i>Select User</label>
            <select id="topupUser" class="form-select" required>
              <option value="">Choose a user...</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label"><i class="fas fa-money-bill-wave"></i>Amount (RM)</label>
            <input type="number" id="topupAmount" class="form-input" step="0.01" min="0.01" placeholder="0.00" required>
          </div>
          
          <div class="form-buttons">
            <button type="button" class="btn-secondary" onclick="closeTopupModal()">
              <i class="fas fa-times"></i>Cancel
            </button>
            <button type="submit" class="btn-primary">
              <i class="fas fa-plus-circle"></i>Top Up
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-title"><i class="fas fa-edit"></i>Edit a Petty Cash Record</span>
        <span class="close" onclick="closeEditModal()">&times;</span>
      </div>
      <div class="modal-body">
        <form class="form-container" onsubmit="saveEditedRecord(event)">
          <div class="form-group">
            <label class="form-label"><i class="fas fa-clipboard-list"></i>Purpose</label>
            <input type="text" id="editPurpose" class="form-input" required>
          </div>
          
          <div class="form-group">
            <label class="form-label"><i class="fas fa-money-bill-wave"></i>Amount (RM)</label>
            <input type="number" id="editAmount" class="form-input" step="0.01" min="0" required>
          </div>
          
          <div class="form-group">
            <label class="form-label"><i class="fas fa-comment"></i>Remarks</label>
            <textarea id="editRemarks" class="form-textarea" rows="3"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label"><i class="fas fa-flag"></i>Status</label>
            <select id="editStatus" class="form-select" required>
            </select>
          </div>
          
          <div class="form-buttons">
            <button type="button" class="btn-secondary" onclick="closeEditModal()">
              <i class="fas fa-times"></i>Cancel
            </button>
            <button type="submit" class="btn-success">
              <i class="fas fa-save"></i>Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Custom Alert Modal -->
  <div id="alertModal" class="alert-modal">
    <div class="alert-content">
      <div class="alert-header">
        <div class="alert-title" id="alertTitle">
          <i class="fas fa-info-circle"></i>Information
        </div>
      </div>
      <div class="alert-body">
        <div class="alert-message" id="alertMessage"></div>
        <div class="alert-buttons" id="alertButtons">
          <button class="alert-btn alert-btn-primary" onclick="closeAlert()">OK</button>
        </div>
      </div>
    </div>
  </div>
</main>
  <script>
    let currentData = [];
    let filteredData = [];
    let statusOptions = [];
    let editingRowNumber = null;
    let balanceData = [];

        
        document.addEventListener('DOMContentLoaded', function() {
          
          const sidebar = document.getElementById('sidebar');
          const mainContent = document.getElementById('mainContent');
          const sidebarToggle = document.getElementById('sidebarToggle');
          const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');
          
          
          const overlay = document.createElement('div');
          overlay.className = 'sidebar-overlay';
          document.body.appendChild(overlay);
          
          
          const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
          if (sidebarCollapsed && window.innerWidth > 768) {
            sidebar.classList.add('collapsed');
            mainContent.classList.add('expanded');
          }
          
          
          function toggleSidebar(event) {
            if (event) event.stopPropagation();
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
          }
          
          
          function toggleMobileSidebar(event) {
            if (event) event.stopPropagation();
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
          }
          
          
          if (sidebarToggle) {
            sidebarToggle.addEventListener('click', toggleSidebar);
          }
          
          if (mobileSidebarToggle) {
            mobileSidebarToggle.addEventListener('click', toggleMobileSidebar);
          }
          
          
          overlay.addEventListener('click', function() {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
          });
          
          
          document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                event.target !== mobileSidebarToggle &&
                !mobileSidebarToggle.contains(event.target)) {
              sidebar.classList.remove('open');
              overlay.classList.remove('active');
            }
          });
          
          
          window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
              
              sidebar.classList.remove('open');
              overlay.classList.remove('active');
              
              
              if (localStorage.getItem('sidebarCollapsed') === 'true') {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('expanded');
              } else {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('expanded');
              }
            } else {
              
              sidebar.classList.remove('collapsed');
              mainContent.classList.remove('expanded');
            }
          });
          
          
          const currentPath = window.location.pathname;
          const sidebarItems = document.querySelectorAll('.sidebar-item');
          
          sidebarItems.forEach(item => {
            const itemPath = item.getAttribute('href');
            if (itemPath && (currentPath.includes(itemPath) || 
                (currentPath === '/' && itemPath === '#'))) {
              item.classList.add('active');
            }
          });
        });

    function loadData() {
      showLoading();
      
      google.script.run
        .withSuccessHandler(onDataLoaded)
        .withFailureHandler(onError)
        .getPettyCashData();
    }

    function onDataLoaded(data) {
      currentData = data.reverse();
      filteredData = data.reverse();
      hideLoading();
      displayData(data.reverse());
      populateFilters(data.reverse());
      loadStatusOptions();
      loadUsernames();
    }

    function onError(error) {
      console.error('Error:', error);
      hideLoading();
      showError();
    }

    function showLoading() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('error').style.display = 'none';
      document.getElementById('dataContainer').style.display = 'none';
    }

    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }

    function showError() {
      document.getElementById('error').style.display = 'block';
      document.getElementById('dataContainer').style.display = 'none';
    }

    function loadStatusOptions() {
      google.script.run
        .withSuccessHandler(function(options) {
          statusOptions = options;
        })
        .withFailureHandler(function(error) {
          console.error('Error loading status options:', error);
        })
        .getStatusOptions();
    }

    function loadUsernames() {
      google.script.run
        .withSuccessHandler(function(usernames) {
          const select = document.getElementById('topupUser');
          select.innerHTML = '<option value="">Choose a user...</option>';
          usernames.forEach(username => {
            const option = document.createElement('option');
            option.value = username;
            option.textContent = username;
            select.appendChild(option);
          });
        })
        .withFailureHandler(function(error) {
          console.error('Error loading usernames:', error);
        })
        .getUsernames();
    }

    function populateFilters(data) {
      const reviewers = [...new Set(data.map(item => item.reviewedBy).filter(Boolean))];
      const persons = [...new Set(data.map(item => item.personOfSubmission).filter(Boolean))];
      const types = [...new Set(data.map(item => item.transactionType).filter(Boolean))];
      const statuses = [...new Set(data.map(item => item.status).filter(Boolean))];

      populateSelect('reviewerFilter', reviewers);
      populateSelect('personFilter', persons);
      populateSelect('typeFilter', types);
      populateSelect('statusFilter', statuses);
    }

    function populateSelect(selectId, options) {
      const select = document.getElementById(selectId);
      const currentValue = select.value;
      
      while (select.children.length > 1) {
        select.removeChild(select.lastChild);
      }
      
      options.sort().forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option;
        optionElement.textContent = option;
        select.appendChild(optionElement);
      });
      
      select.value = currentValue;
    }

    function filterData() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const reviewerFilter = document.getElementById('reviewerFilter').value;
      const personFilter = document.getElementById('personFilter').value;
      const typeFilter = document.getElementById('typeFilter').value;
      const statusFilter = document.getElementById('statusFilter').value;

      filteredData = currentData.filter(item => {
        const matchesSearch = !searchTerm || 
          Object.values(item).some(value => 
            value.toString().toLowerCase().includes(searchTerm)
          );
        
        const matchesReviewer = !reviewerFilter || item.reviewedBy === reviewerFilter;
        const matchesPerson = !personFilter || item.personOfSubmission === personFilter;
        const matchesType = !typeFilter || item.transactionType === typeFilter;
        const matchesStatus = !statusFilter || item.status === statusFilter;

        return matchesSearch && matchesReviewer && matchesPerson && matchesType && matchesStatus;
      });

      displayData(filteredData);
    }

    function displayData(data) {
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = '';
      
      if (data.length === 0) {
        const row = tableBody.insertRow();
        const cell = row.insertCell();
        cell.colSpan = 10;
        cell.innerHTML = '<i class="fas fa-search" style="font-size: 24px; color: #6c757d; margin-bottom: 10px;"></i><br>No data found';
        cell.style.textAlign = 'center';
        cell.style.padding = '60px';
        cell.style.color = '#6c757d';
      } else {
        data.forEach(item => {
          const row = tableBody.insertRow();
          row.dataset.rowNumber = item.rowNumber;
          
          
          const timestampCell = row.insertCell();
          timestampCell.textContent = item.timestamp;
          timestampCell.className = 'timestamp-cell';
          
          
          const reviewedByCell = row.insertCell();
          reviewedByCell.textContent = item.reviewedBy;
          
          
          const personCell = row.insertCell();
          personCell.textContent = item.personOfSubmission;
          
          
          const purposeCell = row.insertCell();
          purposeCell.textContent = item.purpose;
          
          
          const typeCell = row.insertCell();
          typeCell.textContent = item.transactionType;
          
          
          const amountCell = row.insertCell();
          amountCell.textContent = item.amount ? `RM ${item.amount}` : '';
          amountCell.className = 'amount-cell';
          
          
          const docsCell = row.insertCell();
          if (item.additionalDocs && item.additionalDocs.trim()) {
            const docBtn = document.createElement('button');
            docBtn.innerHTML = '<i class="fas fa-file-alt"></i>View Document';
            docBtn.className = 'doc-btn';
            docBtn.onclick = () => window.open(item.additionalDocs, '_blank');
            docsCell.appendChild(docBtn);
          }
          
          
          const remarksCell = row.insertCell();
          remarksCell.textContent = item.remarks;
          
          
          const statusCell = row.insertCell();
          const statusSpan = document.createElement('span');
          statusSpan.textContent = item.status;
          
          const statusLower = item.status.toLowerCase();
          if (statusLower === 'submitted' || statusLower === '') {
            statusSpan.className = 'status-submitted';
            statusSpan.innerHTML = '<i class="fas fa-clock"></i>' + item.status;
          } else if (statusLower === 'approved') {
            statusSpan.className = 'status-approved';
            statusSpan.innerHTML = '<i class="fas fa-check-circle"></i>' + item.status;
          } else if (statusLower === 'rejected') {
            statusSpan.className = 'status-rejected';
            statusSpan.innerHTML = '<i class="fas fa-times-circle"></i>' + item.status;
          } else {
            statusSpan.className = 'status-submitted';
            statusSpan.innerHTML = '<i class="fas fa-clock"></i>' + item.status;
          }
          
          statusCell.appendChild(statusSpan);
          
          
          const actionsCell = row.insertCell();
          actionsCell.innerHTML = `
            <div class="action-buttons">
              <button class="edit-btn" onclick="openEditModal(${item.rowNumber})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="delete-btn" onclick="confirmDelete(${item.rowNumber})">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          `;
        });
      }
      
      document.getElementById('dataContainer').style.display = 'block';
    }

    function openEditModal(rowNumber) {
      const item = currentData.find(item => item.rowNumber === rowNumber);
      if (!item) return;
      
      editingRowNumber = rowNumber;
      
      document.getElementById('editPurpose').value = item.purpose || '';
      document.getElementById('editAmount').value = item.amount || '';
      document.getElementById('editRemarks').value = item.remarks || '';
      
      const statusSelect = document.getElementById('editStatus');
      statusSelect.innerHTML = '';
      statusOptions.forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option;
        optionElement.textContent = option;
        if (option === item.status) {
          optionElement.selected = true;
        }
        statusSelect.appendChild(optionElement);
      });
      
      document.getElementById('editModal').style.display = 'block';
    }

    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      editingRowNumber = null;
    }

    function saveEditedRecord(event) {
      event.preventDefault();
      
      if (!editingRowNumber) return;
      
      const updatedData = {
        rowNumber: editingRowNumber,
        purpose: document.getElementById('editPurpose').value,
        amount: parseFloat(document.getElementById('editAmount').value) || 0,
        remarks: document.getElementById('editRemarks').value,
        status: document.getElementById('editStatus').value
      };
      
      const submitBtn = event.target.querySelector('button[type="submit"]');
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>Saving...';
      submitBtn.disabled = true;
      
      google.script.run
        .withSuccessHandler(function() {
          const dataIndex = currentData.findIndex(item => item.rowNumber === editingRowNumber);
          if (dataIndex !== -1) {
            currentData[dataIndex].purpose = updatedData.purpose;
            currentData[dataIndex].amount = updatedData.amount.toFixed(2);
            currentData[dataIndex].remarks = updatedData.remarks;
            currentData[dataIndex].status = updatedData.status;
          }
          
          closeEditModal();
          filterData();
          showAlert('Success', 'Record updated successfully!', 'success');
        })
        .withFailureHandler(function(error) {
          console.error('Error saving:', error);
          showAlert('Error', 'Error saving changes. Please try again.', 'error');
          submitBtn.innerHTML = '<i class="fas fa-save"></i>Save Changes';
          submitBtn.disabled = false;
        })
        .updateRecord(updatedData);
    }

    function confirmDelete(rowNumber) {
      showConfirm(
        'Confirm Delete',
        'Are you sure you want to delete this record? This action cannot be undone.',
        function() {
          deleteRow(rowNumber);
        }
      );
    }

    function deleteRow(rowNumber) {
      google.script.run
        .withSuccessHandler(function() {
          currentData = currentData.filter(item => item.rowNumber !== rowNumber);
          filterData();
          showAlert('Success', 'Record deleted successfully!', 'success');
        })
        .withFailureHandler(function(error) {
          console.error('Error deleting:', error);
          showAlert('Error', 'Error deleting record. Please try again.', 'error');
        })
        .deleteRecord(rowNumber);
    }

    function openBalanceModal() {
      document.getElementById('balanceModal').style.display = 'block';
      loadBalanceData();
    }

    function closeBalanceModal() {
      document.getElementById('balanceModal').style.display = 'none';
    }

    function openTopupModal() {
      document.getElementById('topupModal').style.display = 'block';
      document.getElementById('topupUser').value = '';
      document.getElementById('topupAmount').value = '';
    }

    function closeTopupModal() {
      document.getElementById('topupModal').style.display = 'none';
    }

    function submitTopup(event) {
      event.preventDefault();
      
      const username = document.getElementById('topupUser').value;
      const amount = parseFloat(document.getElementById('topupAmount').value);
      
      if (!username || !amount || amount <= 0) {
        showAlert('Validation Error', 'Please select a user and enter a valid amount.', 'warning');
        return;
      }
      
      const submitBtn = event.target.querySelector('button[type="submit"]');
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>Processing...';
      submitBtn.disabled = true;
      
      google.script.run
        .withSuccessHandler(function() {
          submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i>Top Up';
          submitBtn.disabled = false;
          
          closeTopupModal();
          loadData();
          showAlert('Success', 'Top up successful!', 'success');
        })
        .withFailureHandler(function(error) {
          console.error('Error with top up:', error);
          showAlert('Error', 'Error processing top up. Please try again.', 'error');
          submitBtn.innerHTML = '<i class="fas fa-plus-circle"></i>Top Up';
          submitBtn.disabled = false;
        })
        .processTopup(username, amount);
    }


    function loadBalanceData() {
      document.getElementById('balanceLoading').style.display = 'block';
      document.getElementById('balanceError').style.display = 'none';
      document.getElementById('balanceContent').style.display = 'none';
      
      google.script.run
        .withSuccessHandler(onBalanceDataLoaded)
        .withFailureHandler(onBalanceError)
        .getUsersBalanceData();
    }

    function onBalanceDataLoaded(data) {
      balanceData = data;
      document.getElementById('balanceLoading').style.display = 'none';
      displayBalanceData(data);
    }

    function onBalanceError(error) {
      console.error('Balance Error:', error);
      document.getElementById('balanceLoading').style.display = 'none';
      document.getElementById('balanceError').style.display = 'block';
    }

    function displayBalanceData(data) {
      const balanceContent = document.getElementById('balanceContent');
      balanceContent.innerHTML = '';
      
      if (data.length === 0) {
        balanceContent.innerHTML = '<p style="text-align: center; color: #6c757d; grid-column: 1/-1;"><i class="fas fa-users" style="font-size: 48px; margin-bottom: 15px; display: block;"></i>No balance data found</p>';
      } else {
        data.forEach((user, index) => {
          const card = document.createElement('div');
          card.className = `balance-card ${user.statusClass}`;
          card.setAttribute('data-user-index', index);
          
          let statusIcon = '';
          switch(user.statusClass) {
            case 'sufficient':
              statusIcon = 'fas fa-check-circle';
              break;
            case 'critical':
              statusIcon = 'fas fa-exclamation-triangle';
              break;
            case 'low':
              statusIcon = 'fas fa-exclamation-circle';
              break;
            case 'overdrawn':
              statusIcon = 'fas fa-times-circle';
              break;
            default:
              statusIcon = 'fas fa-info-circle';
          }
          
          card.innerHTML = `
            <button class="edit-minimum-btn" onclick="editMinimumBalance('${user.username}', '${user.minimumBalance}', ${index})">
              <i class="fas fa-edit"></i>Edit Min
            </button>
            <div class="balance-username">
              <i class="fas fa-user-circle"></i>${user.username}
            </div>
            <div class="balance-info">
              <div class="balance-row">
                <span class="balance-label">
                  <i class="fas fa-wallet"></i>Current Balance:
                </span>
                <span class="balance-value">RM ${user.currentBalance}</span>
              </div>
              <div class="balance-row">
                <span class="balance-label">
                  <i class="fas fa-chart-line"></i>Minimum Balance:
                </span>
                <span class="balance-value">RM ${user.minimumBalance}</span>
              </div>
              <div class="balance-status ${user.statusClass}">
                <i class="${statusIcon}"></i>${user.status}
              </div>
            </div>
          `;
          
          balanceContent.appendChild(card);
        });
      }
      
      document.getElementById('balanceContent').style.display = 'grid';
    }

    function editMinimumBalance(username, currentMinimum, userIndex) {
      const card = document.querySelector(`[data-user-index="${userIndex}"]`);
      const editForm = card.querySelector('.minimum-edit-form');
      
      if (editForm) {
        editForm.remove();
        return;
      }
      
      const formHtml = `
        <div class="minimum-edit-form" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid rgba(45, 12, 49, 0.1);">
          <div class="form-group">
            <label class="form-label" style="font-size: 14px;">
              <i class="fas fa-edit"></i>New Minimum Balance
            </label>
            <input type="number" class="form-input" style="padding: 10px 14px; font-size: 14px;" step="0.01" min="0" value="${currentMinimum}" placeholder="Enter minimum balance">
          </div>
          <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button class="btn-success" style="padding: 8px 16px; font-size: 12px;" onclick="saveMinimumBalance('${username}', ${userIndex}, this)">
              <i class="fas fa-save"></i>Save
            </button>
            <button class="btn-secondary" style="padding: 8px 16px; font-size: 12px;" onclick="cancelMinimumEdit(${userIndex})">
              <i class="fas fa-times"></i>Cancel
            </button>
          </div>
        </div>
      `;
      
      card.insertAdjacentHTML('beforeend', formHtml);
    }

    function saveMinimumBalance(username, userIndex, button) {
      const card = document.querySelector(`[data-user-index="${userIndex}"]`);
      const input = card.querySelector('.form-input');
      const newMinimum = parseFloat(input.value);
      
      if (isNaN(newMinimum) || newMinimum < 0) {
        showAlert('Validation Error', 'Please enter a valid minimum balance.', 'warning');
        return;
      }
      
      button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>Saving...';
      button.disabled = true;
      
      google.script.run
        .withSuccessHandler(function() {
          balanceData[userIndex].minimumBalance = newMinimum.toFixed(2);
          
          const currentBalance = parseFloat(balanceData[userIndex].currentBalance);
          const difference = currentBalance - newMinimum;
          
          if (difference < 0) {
            balanceData[userIndex].status = 'Overdrawn';
            balanceData[userIndex].statusClass = 'overdrawn';
          } else if (difference === 0) {
            balanceData[userIndex].status = 'Low';
            balanceData[userIndex].statusClass = 'low';
          } else if (difference <= 10) {
            balanceData[userIndex].status = 'Critical';
            balanceData[userIndex].statusClass = 'critical';
          } else if (difference >= 50) {
            balanceData[userIndex].status = 'Sufficient';
            balanceData[userIndex].statusClass = 'sufficient';
          } else {
            balanceData[userIndex].status = 'Critical';
            balanceData[userIndex].statusClass = 'critical';
          }
          
          displayBalanceData(balanceData);
          showAlert('Success', 'Minimum balance updated successfully!', 'success');
        })
        .withFailureHandler(function(error) {
          console.error('Error updating minimum balance:', error);
          showAlert('Error', 'Error updating minimum balance. Please try again.', 'error');
          button.innerHTML = '<i class="fas fa-save"></i>Save';
          button.disabled = false;
        })
        .updateMinimumBalance(username, newMinimum);
    }

    function cancelMinimumEdit(userIndex) {
      const card = document.querySelector(`[data-user-index="${userIndex}"]`);
      const editForm = card.querySelector('.minimum-edit-form');
      if (editForm) {
        editForm.remove();
      }
    }

    
    function showAlert(title, message, type = 'info') {
      const alertModal = document.getElementById('alertModal');
      const alertTitle = document.getElementById('alertTitle');
      const alertMessage = document.getElementById('alertMessage');
      const alertButtons = document.getElementById('alertButtons');
      
      let icon = 'fas fa-info-circle';
      switch(type) {
        case 'success':
          icon = 'fas fa-check-circle';
          break;
        case 'error':
          icon = 'fas fa-times-circle';
          break;
        case 'warning':
          icon = 'fas fa-exclamation-triangle';
          break;
      }
      
      alertTitle.innerHTML = `<i class="${icon}"></i>${title}`;
      alertMessage.textContent = message;
      alertButtons.innerHTML = '<button class="alert-btn alert-btn-primary" onclick="closeAlert()"><i class="fas fa-check"></i>OK</button>';
      
      alertModal.style.display = 'block';
    }

    function showConfirm(title, message, onConfirm) {
      const alertModal = document.getElementById('alertModal');
      const alertTitle = document.getElementById('alertTitle');
      const alertMessage = document.getElementById('alertMessage');
      const alertButtons = document.getElementById('alertButtons');
      
      alertTitle.innerHTML = '<i class="fas fa-question-circle"></i>' + title;
      alertMessage.textContent = message;
      alertButtons.innerHTML = `
        <button class="alert-btn alert-btn-secondary" onclick="closeAlert()">
          <i class="fas fa-times"></i>Cancel
        </button>
        <button class="alert-btn alert-btn-primary" onclick="confirmAction()">
          <i class="fas fa-check"></i>Confirm
        </button>
      `;
      
      window.currentConfirmAction = onConfirm;
      alertModal.style.display = 'block';
    }

    function confirmAction() {
      if (window.currentConfirmAction) {
        window.currentConfirmAction();
        window.currentConfirmAction = null;
      }
      closeAlert();
    }

    function closeAlert() {
      document.getElementById('alertModal').style.display = 'none';
    }

    
    window.onclick = function(event) {
      const modals = ['balanceModal', 'topupModal', 'editModal', 'alertModal'];
      modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target === modal) {
          modal.style.display = 'none';
          if (modalId === 'editModal') {
            editingRowNumber = null;
          }
        }
      });
    }

    
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
    });
  </script>
</body>
</html>
